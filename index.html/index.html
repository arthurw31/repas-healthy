<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner Pro</title>
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Smart Meal Planning Platform">
    
    <!-- PWA Manifest -->
    <link rel="manifest" data-href="data:application/json;base64,ewogICJuYW1lIjogIk1lYWwgUGxhbm5lciBQcm8iLAogICJzaG9ydF9uYW1lIjogIk1lYWxQcm8iLAogICJkZXNjcmlwdGlvbiI6ICJBSS1Qb3dlcmVkIE1lYWwgUGxhbm5pbmcgUGxhdGZvcm0iLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMTcyYSIsCiAgInRoZW1lX2NvbG9yIjogIiMwZjE3MmEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI3YVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2QybGtkR2c5SWpFeU9DSWlJR2hsYVdkb2REMGlNVEk0SWlCbWFXeHNQU0lqTUdZeE56SmhJaTgrUEhSbGVIUWdlRDBpTmpRaUlIazlJalkwSWlCbWIyNTBMV1poYldsc2VUMGlRWEpwWVd3aUlHWnZiblF0YzJsNlpUMGlNelppSWlCbWFXeHNQU0lqWm1abVptWm1JajQ0WXo4dkszUmxlSFErUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzBmMTcyYSIvPjx0ZXh0IHg9IjY0IiB5PSI2NCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjM2IiBmaWxsPSIjZmZmZmZmIj7wn42dPC90ZXh0Pjwvc3ZnPg==">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f8fafc;
            --accent: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 25%, #e2e8f0 50%, #cbd5e1 75%, #94a3b8 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Navigation */
        .nav {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 80px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .nav-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #374151;
        }
        
        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        @media (max-width: 768px) {
            .nav-actions {
                gap: 8px;
            }
            
            .nav-actions .btn {
                padding: 12px 18px;
                font-size: 13px;
                font-weight: 600;
                width: auto;
                max-width: none;
            }
        }
        
        /* Hero Section */
        .hero {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 100px 24px 140px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.25) 0%, transparent 50%);
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        .hero h1 {
            font-size: 4.5rem;
            font-weight: 900;
            color: #1f2937;
            margin-bottom: 24px;
            letter-spacing: -0.025em;
            line-height: 1.1;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .hero p {
            font-size: 1.4rem;
            color: #374151;
            margin-bottom: 40px;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .hero-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 16px 32px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 15px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 50%, #e2e8f0 100%);
            color: #1f2937;
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(255, 255, 255, 0.6);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(255, 255, 255, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 50%, #374151 100%);
            color: white;
            box-shadow: 0 15px 35px rgba(107, 114, 128, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(107, 114, 128, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 50%, #4b5563 100%);
            color: white;
            box-shadow: 0 15px 35px rgba(156, 163, 175, 0.3);
        }
        
        .btn-warning:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(156, 163, 175, 0.4);
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: -60px auto 0;
            padding: 0 24px 80px;
            position: relative;
            z-index: 10;
        }
        
        /* Random Result */
        .random-result {
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            color: white;
            padding: 32px;
            border-radius: 20px;
            margin-bottom: 32px;
            text-align: center;
            display: none;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px -10px rgba(99, 102, 241, 0.4);
        }
        
        .random-result.show {
            display: block;
        }
        
        .random-result h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .menu-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .menu-item-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .menu-item-value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Main Dashboard */
        .dashboard {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        .dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(55, 65, 81, 0.9) 100%);
            backdrop-filter: blur(20px);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--gray-200);
        }
        
        .category-section {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            padding: 30px;
            min-height: 500px;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .category-section:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Mobile - Maintenir les colonnes côte à côte */
        @media (max-width: 768px) {
            .content-grid {
                display: flex;
                overflow-x: auto;
                gap: 16px;
                padding: 16px;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }
            
            .category-section {
                min-width: 280px;
                flex-shrink: 0;
                scroll-snap-align: start;
                border-radius: 20px;
                min-height: 400px;
                padding: 20px;
            }
        }
        
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
        }
        
        .category-emoji {
            font-size: 1.5rem;
        }
        
        .add-category-btn {
            background: var(--gray-100);
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            display: none;
            transition: all 0.2s ease;
        }
        
        .add-category-btn:hover {
            background: var(--gray-200);
        }
        
        .edit-mode .add-category-btn {
            display: block;
        }
        
        /* Items */
        .item {
            display: block;
            padding: 16px 20px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            user-select: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .item:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.6);
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }
        
        .item.selected {
            background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(191, 219, 254, 0.9) 100%);
            border: 2px solid #3b82f6;
            color: #1e40af;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }
        
        .delete-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: none;
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }
        
        .edit-mode .item:hover .delete-btn {
            display: block;
        }
        
        .add-item-btn {
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-50) 100%);
            border: 2px dashed var(--gray-300);
            color: var(--gray-500);
            text-align: center;
            padding: 16px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: none;
            transition: all 0.3s ease;
        }
        
        .edit-mode .add-item-btn {
            display: block;
        }
        
        .add-item-btn:hover {
            background: white;
            border-color: var(--gray-400);
            color: var(--gray-700);
        }
        
        .item-input {
            width: 100%;
            padding: 12px 16px;
            margin: 8px 0;
            border: 2px solid var(--accent);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
        }
        
        .item-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        /* Category specific colors */
        .category-section:nth-child(1) .item:hover { border-color: #ef4444; }
        .category-section:nth-child(2) .item:hover { border-color: #06b6d4; }
        .category-section:nth-child(3) .item:hover { border-color: #3b82f6; }
        .category-section:nth-child(4) .item:hover { border-color: #10b981; }
        .category-section:nth-child(5) .item:hover { border-color: #f59e0b; }
        .category-section:nth-child(6) .item:hover { border-color: #8b5cf6; }
        .category-section:nth-child(7) .item:hover { border-color: #ec4899; }
        
        /* Mobile - Gardez toujours les colonnes côte à côte */
        @media (max-width: 1200px) {
            .content-grid {
                display: flex;
                overflow-x: auto;
                gap: 16px;
                padding: 16px;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }
            
            .category-section {
                min-width: 280px;
                flex-shrink: 0;
                scroll-snap-align: start;
                border-radius: 20px;
                min-height: 400px;
                padding: 20px;
            }
        }
        
        @media (max-width: 900px) {
            .category-section {
                min-width: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero {
                padding: 60px 16px 80px;
            }
            
            .container {
                padding: 0 16px 60px;
                margin-top: -40px;
            }
            
            .nav-content {
                padding: 0 16px;
                height: 80px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                padding: 20px 24px;
                flex-direction: column;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }
            
            .category-section {
                min-height: 300px;
            }
        }
        
        .install-banner {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 32px;
            text-align: center;
            display: none;
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.3);
        }
        
        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Simple auth overlay - minimal style */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .auth-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .auth-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .auth-overlay.show .auth-box {
            transform: scale(1);
        }

        .auth-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 20px;
            color: #1f2937;
        }

        .google-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .google-btn:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }

        /* Styles pour les nouveaux éléments */
        .item.favorite {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 193, 7, 0.1) 100%);
            border-color: #ffd700;
        }
        
        .item.custom {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            border-left: 4px solid #10b981;
        }
        
        .favorite-icon {
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <!-- Simple auth overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-box">
            <h2 class="auth-title">🍽️ MealPro</h2>
            <p style="color: #6b7280; margin-bottom: 30px;">Connectez-vous pour synchroniser vos données</p>
            
            <button class="google-btn" id="googleSignIn">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continuer avec Google
            </button>
            
            <p style="font-size: 12px; color: #9ca3af;">
                Vos données seront synchronisées en toute sécurité
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#" class="logo">🍽️ MealPro</a>
            <div class="nav-actions">
                <div class="user-info" id="userInfo" style="display: none;">
                    <img class="user-avatar" id="userAvatar" src="" alt="Avatar">
                    <span id="userName"></span>
                </div>
                <span class="sync-indicator" id="syncStatus" style="display: none;">✅ Synchronisé</span>
                <button class="btn btn-secondary" id="logoutBtn" style="display: none; font-size: 12px; padding: 8px 16px;">
                    🚪 Déco
                </button>
                <button class="btn btn-primary" id="resetDataBtn" style="display: none; font-size: 12px; padding: 8px 16px; background: #f59e0b;">
                    🔄 Réinit
                </button>
                <button class="btn btn-success" id="randomMenuBtn">
                    🎲 Generate Menu
                </button>
                <button class="btn btn-warning edit-toggle" id="editToggle">
                    ✏️ Edit Mode
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Plan. Cook. Enjoy</h1>
            <p>Smart meal planning that adapts to your lifestyle. Create healthy, delicious meals with zero hassle.</p>
        </div>
    </section>

    <!-- Main Container -->
    <div class="container">
        <!-- Install Banner -->
        <div class="install-banner" id="installBanner">
            📱 Install this app on your device for quick access!
            <button class="install-btn" id="installBtn">Install Now</button>
        </div>

        <!-- Random Result -->
        <div class="random-result" id="randomResult">
            <h3>🎯 Your Personalized Menu</h3>
            <div class="menu-items" id="menuContent"></div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <div class="dashboard-header">
                <div class="dashboard-title">Meal Planning Dashboard</div>
                <div class="dashboard-actions">
                    <span style="font-size: 14px; opacity: 0.8;">💡 Double-cliquez sur un élément pour des recettes</span>
                </div>
            </div>

            <div class="content-grid">
                <div class="category-section" data-category="entrees">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🥗</span>
                            Entrée
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une entrée</div>
                </div>

                <div class="category-section" data-category="sauces">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🥄</span>
                            Base Sauce
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une base sauce</div>
                </div>

                <div class="category-section" data-category="proteines">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🍖</span>
                            Protéine
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une protéine</div>
                </div>

                <div class="category-section" data-category="glucides">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🌾</span>
                            Féculent
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter un féculent</div>
                </div>

                <div class="category-section" data-category="legumes">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🥬</span>
                            Légumes
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter des légumes</div>
                </div>

                <div class="category-section" data-category="cuissons">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">⚡</span>
                            Technique Cuisson
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une technique</div>
                </div>

                <div class="category-section" data-category="desserts">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">🍨</span>
                            Dessert
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter un dessert</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration Firebase - CLÉS CORRIGÉES
        const firebaseConfig = {
            apiKey: "AIzaSyDunACCEQRqr4jglsPl6BUy_Gs5SCTqKuw",
            authDomain: "mealpro-4a148.firebaseapp.com",
            projectId: "mealpro-4a148",
            storageBucket: "mealpro-4a148.firebasestorage.app",
            messagingSenderId: "480098718071",
            appId: "1:480098718071:web:e746015ce5c8557adcd172",
            measurementId: "G-Q2XD8SVTJQ"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Variables globales
        let currentUser = null;
        let editMode = false;
        let menusGenerated = parseInt(localStorage.getItem('menusGenerated')) || 0;
        const categories = ['entrees', 'sauces', 'proteines', 'glucides', 'legumes', 'cuissons', 'desserts'];

        // Données par défaut
        const defaultData = {
            entrees: ["Soupe froide", "Gaspacho", "Velouté", "Soupe miso", "Bouillon", "Consommé", "Salade verte", "Salade composée", "Salade de céréales", "Bowl cru", "Crudités", "Carpaccio", "Tartare", "Ceviche", "Hummus", "Guacamole", "Baba ganoush", "Tapenade", "Dips", "Mousse", "Terrine"],
            sauces: ["Base fromage blanc", "Base yaourt grec", "Base sauce soja", "Base miso", "Base tahini", "Mayo avocat", "Mayo yaourt", "Vinaigrette classique", "Vinaigrette asiatique", "Pesto", "Chimichurri", "Sauce verte", "Sauce épicée", "Sauce crémeuse", "Marinade", "Émulsion"],
            proteines: ["Grillé", "Air fryer", "Mariné", "Mi-cuit", "Fumé", "Vapeur", "Papillote", "Sauté", "Poêlé", "Effiloché", "Mollet", "Brouillé", "En omelette", "Confit", "Cru", "Slow cook", "Sous-vide", "Rôti", "Braisé", "En sauce", "Pané", "Laqué"],
            glucides: ["Riz complet", "Riz noir", "Riz rouge", "Quinoa", "Boulgour", "Épeautre", "Sarrasin", "Farro", "Orge", "Millet", "Avoine salée", "Pâtes complètes", "Pâtes légumineuses", "Shiratakis", "Patate douce", "Pommes de terre", "Courge", "Riz de chou-fleur", "Courgetti", "Pain complet", "Galettes", "Polenta"],
            legumes: ["Vapeur", "Air fryer", "Grillés", "Rôtis four", "Poêlés", "Sautés wok", "Braisés", "Confits", "Papillote", "Crus", "Massés", "Marinés", "Lacto-fermentés", "Pickles", "Glacés", "À l'étouffée", "Tempura", "Fumés", "En soupe", "En purée", "En chips", "Spiralés"],
            cuissons: ["Air Fryer 180°C", "Plancha haute température", "Grill/Barbecue", "Poêle antiadhésive", "Wok sauté rapide", "Four 200°C chaleur tournante", "Four vapeur 85°C", "Cuisson vapeur douce", "Papillote hermétique", "Pochage eau frémissante", "Marinade à froid", "Sous-vide basse température", "Smoking fumage léger", "Searing haute température", "Braisage cocotte", "Slow cooking mijoteuse", "Fermentation lactique", "Déshydratation", "Cru mariné acidulé", "Confit huile d'olive"],
            desserts: ["Nice cream", "Chia pudding", "Mousse", "Yaourt grec", "Skyr", "Fromage blanc", "Compote", "Fruits pochés", "Salade de fruits", "Energy balls", "Bark chocolat", "Smoothie bowl", "Panna cotta", "Tiramisù", "Cheesecake cru", "Tarte crue", "Muffins", "Cookies", "Granola", "Parfait", "Sorbet", "Pudding"]
        };

        // Variable pour stocker les données utilisateur
        let userData = {};

        // Gestion de l'état d'authentification avec diagnostic amélioré
        auth.onAuthStateChanged(async (user) => {
            console.log('=== CHANGEMENT ÉTAT AUTH ===');
            console.log('Utilisateur:', user ? user.email : 'non connecté');
            currentUser = user;
            
            if (user) {
                // Utilisateur connecté
                console.log('🔗 Utilisateur connecté:', user.email);
                document.getElementById('authOverlay').classList.remove('show');
                
                // Afficher les informations utilisateur
                const userInfo = document.getElementById('userInfo');
                const userAvatar = document.getElementById('userAvatar');
                const userName = document.getElementById('userName');
                
                if (user.photoURL) {
                    userAvatar.src = user.photoURL;
                }
                userName.textContent = user.displayName || user.email.split('@')[0];
                userInfo.style.display = 'flex';
                
                document.getElementById('syncStatus').style.display = 'inline';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('resetDataBtn').style.display = 'inline-block';
                document.getElementById('syncStatus').textContent = '⏳ Chargement...';
                
                try {
                    // Charger les données avec diagnostic complet
                    await loadFreshDataFromFirebase();
                    renderData();
                    document.getElementById('syncStatus').textContent = '✅ Synchronisé';
                    console.log('✅ Données chargées avec succès');
                    showNotification(`Bienvenue ${user.displayName || 'Utilisateur'}!`, 'success');
                } catch (error) {
                    console.error('❌ Erreur chargement données:', error);
                    document.getElementById('syncStatus').textContent = '❌ Erreur';
                    loadLocalData();
                    renderData();
                    showNotification('Erreur de synchronisation - mode local', 'warning');
                }
            } else {
                // Utilisateur non connecté
                console.log('👤 Utilisateur non connecté');
                document.getElementById('authOverlay').classList.add('show');
                document.getElementById('syncStatus').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('resetDataBtn').style.display = 'none';
                document.getElementById('userInfo').style.display = 'none';
                
                // Charger données locales
                loadLocalData();
                renderData();
            }
        });

        // Fonction de chargement avec diagnostic complet et migration automatique
        async function loadFreshDataFromFirebase() {
            if (!currentUser) {
                console.log('❌ Pas d\'utilisateur connecté pour charger les données');
                loadLocalData();
                return;
            }

            console.log('📥 Chargement frais des données depuis Firebase');
            
            // Vérifier d'abord si l'utilisateur existe et sa structure
            const userDocRef = db.collection('users').doc(currentUser.uid);
            try {
                const userDocSnap = await userDocRef.get();
                console.log('📄 Document utilisateur existe:', userDocSnap.exists);
                
                if (userDocSnap.exists) {
                    const userData_doc = userDocSnap.data();
                    console.log('📊 Données utilisateur:', userData_doc);
                    
                    // Vérifier s'il y a l'ancienne structure (data field)
                    if (userData_doc.data) {
                        console.log('🔍 ANCIENNE STRUCTURE DÉTECTÉE!');
                        console.log('📊 Données de l\'ancienne structure:', userData_doc.data);
                        
                        // Migrer vers la nouvelle structure automatiquement
                        await migrateOldToNewStructure(userData_doc.data);
                        return;
                    }
                }
                
                // Initialiser userData
                userData = {};
                
                // Charger depuis les collections séparées avec diagnostic détaillé
                for (const category of categories) {
                    console.log(`📥 Chargement collection: users/${currentUser.uid}/${category}`);
                    
                    try {
                        const userCollectionRef = db.collection('users').doc(currentUser.uid).collection(category);
                        const querySnapshot = await userCollectionRef.get();
                        
                        console.log(`📊 Nombre de documents dans ${category}:`, querySnapshot.size);
                        
                        const items = [];
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            console.log(`📄 Document ${category} (${doc.id}):`, data);
                            
                            // Gérer différentes structures de données
                            let itemName = null;
                            
                            if (data && data.name) {
                                // Structure normale avec champ 'name'
                                itemName = data.name;
                            } else if (typeof data === 'string') {
                                // Document est directement une chaîne
                                itemName = data;
                            } else if (data && Object.keys(data).length === 1) {
                                // Document avec une seule propriété - prendre la valeur
                                const firstKey = Object.keys(data)[0];
                                itemName = data[firstKey];
                            } else if (doc.id && !doc.id.startsWith('temp-') && !doc.id.startsWith('local-')) {
                                // Utiliser l'ID du document si pas d'autre choix
                                itemName = doc.id;
                            }
                            
                            if (itemName && typeof itemName === 'string' && itemName.trim()) {
                                items.push({
                                    id: doc.id,
                                    name: itemName.trim(),
                                    isFavorite: data.isFavorite || false,
                                    isDefault: data.isDefault !== false, // Par défaut true
                                    createdAt: data.createdAt || new Date(),
                                    tags: data.tags || []
                                });
                                console.log(`✅ Élément ajouté: "${itemName}"`);
                            } else {
                                console.log(`⚠️ Document ignoré - pas de nom valide:`, data);
                            }
                        });
                        
                        userData[category] = items;
                        console.log(`✅ ${category}: ${items.length} éléments chargés:`, items.map(i => i.name));
                    } catch (error) {
                        console.error(`❌ Erreur chargement ${category}:`, error);
                        userData[category] = [];
                    }
                }
                
                // Si toutes les catégories sont vides, initialiser avec les données par défaut
                const totalItems = categories.reduce((sum, cat) => sum + (userData[cat] ? userData[cat].length : 0), 0);
                console.log(`📊 Total d'éléments chargés: ${totalItems}`);
                
                if (totalItems === 0) {
                    console.log('🔄 Aucune donnée trouvée, initialisation avec données par défaut');
                    await initializeUserData();
                    // Recharger après initialisation
                    await loadFreshDataFromFirebase();
                }
                
            } catch (error) {
                console.error('❌ Erreur lecture document utilisateur:', error);
                throw error;
            }
        }

        // Migration de l'ancienne vers la nouvelle structure
        async function migrateOldToNewStructure(oldData) {
            console.log('🔄 Migration de l\'ancienne vers la nouvelle structure...');
            
            try {
                userData = {};
                
                for (const category of categories) {
                    if (oldData[category] && Array.isArray(oldData[category])) {
                        console.log(`📤 Migration de ${category}: ${oldData[category].length} éléments`);
                        
                        userData[category] = [];
                        
                        for (const itemName of oldData[category]) {
                            const docRef = await db.collection('users')
                                .doc(currentUser.uid)
                                .collection(category)
                                .add({
                                    name: itemName,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                    isFavorite: false,
                                    isDefault: true,
                                    tags: []
                                });
                            
                            userData[category].push({
                                id: docRef.id,
                                name: itemName,
                                isFavorite: false,
                                isDefault: true,
                                createdAt: new Date(),
                                tags: []
                            });
                        }
                        
                        console.log(`✅ ${category} migré (${userData[category].length} éléments)`);
                    } else {
                        userData[category] = [];
                    }
                }
                
                // Supprimer l'ancienne structure
                await userDocRef.update({
                    data: firebase.firestore.FieldValue.delete()
                });
                
                console.log('🎉 Migration terminée avec succès!');
                showNotification('Migration des données terminée!', 'success');
                
            } catch (error) {
                console.error('❌ Erreur migration:', error);
                showNotification('Erreur lors de la migration', 'error');
            }
        }

        // Initialiser les données utilisateur dans Firebase
        async function initializeUserData() {
            if (!currentUser) return;
            
            try {
                console.log('🔄 Initialisation des données utilisateur...');
                
                // Créer le document utilisateur principal
                await db.collection('users').doc(currentUser.uid).set({
                    email: currentUser.email,
                    displayName: currentUser.displayName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    menusGenerated: menusGenerated,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Initialiser userData
                userData = {};

                // Créer les collections pour chaque catégorie
                for (const category of categories) {
                    console.log(`📤 Initialisation de la catégorie: ${category}`);
                    
                    userData[category] = [];
                    const categoryRef = db.collection('users').doc(currentUser.uid).collection(category);
                    
                    // Ajouter chaque élément de la catégorie
                    for (const item of defaultData[category]) {
                        const docRef = await categoryRef.add({
                            name: item,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            isFavorite: false,
                            isDefault: true,
                            tags: []
                        });
                        
                        userData[category].push({
                            id: docRef.id,
                            name: item,
                            isFavorite: false,
                            isDefault: true,
                            createdAt: new Date(),
                            tags: []
                        });
                    }
                    
                    console.log(`✅ ${category}: ${userData[category].length} éléments initialisés`);
                }
                
                console.log('✅ Initialisation terminée avec succès');
            } catch (error) {
                console.error('❌ Erreur initialisation:', error);
                throw error;
            }
        }

        // Charger les données locales (fallback)
        function loadLocalData() {
            try {
                const localData = localStorage.getItem('mealPlannerData');
                if (localData) {
                    const simpleData = JSON.parse(localData);
                    userData = {};
                    
                    categories.forEach(category => {
                        if (simpleData[category]) {
                            userData[category] = simpleData[category].map((name, index) => ({
                                id: 'local-' + Date.now() + '-' + index,
                                name: name,
                                isFavorite: false,
                                isDefault: true,
                                createdAt: new Date(),
                                tags: []
                            }));
                        } else {
                            userData[category] = [];
                        }
                    });
                    
                    console.log('📱 Données locales chargées');
                } else {
                    // Utiliser les données par défaut
                    userData = {};
                    categories.forEach(category => {
                        userData[category] = defaultData[category].map((name, index) => ({
                            id: 'default-' + Date.now() + '-' + index,
                            name: name,
                            isFavorite: false,
                            isDefault: true,
                            createdAt: new Date(),
                            tags: []
                        }));
                    });
                    console.log('🏠 Données par défaut chargées');
                }
                
                menusGenerated = parseInt(localStorage.getItem('menusGenerated')) || 0;
            } catch (error) {
                console.error('❌ Erreur chargement local:', error);
            }
        }

        // Connexion Google avec gestion d'erreurs avancée
        document.getElementById('googleSignIn').addEventListener('click', async () => {
            try {
                console.log('🔄 Tentative de connexion Google...');
                updateSyncStatus('⏳ Connexion...');
                
                // Configuration pour forcer la sélection de compte
                const googleProvider = new firebase.auth.GoogleAuthProvider();
                googleProvider.addScope('email');
                googleProvider.addScope('profile');
                googleProvider.setCustomParameters({
                    prompt: 'select_account'
                });
                
                const result = await auth.signInWithPopup(googleProvider);
                console.log('✅ Connexion réussie:', result.user.email);
                
                // Ne pas faire loadFreshDataFromFirebase ici car onAuthStateChanged le fait déjà
                
            } catch (error) {
                console.error('❌ Erreur de connexion détaillée:', error);
                
                let errorMessage = 'Erreur de connexion inconnue';
                
                switch(error.code) {
                    case 'auth/popup-blocked':
                        errorMessage = 'Popup bloqué. Autorisez les popups pour ce site.';
                        break;
                    case 'auth/popup-closed-by-user':
                        errorMessage = 'Connexion annulée.';
                        return; // Ne pas afficher d'erreur si l'utilisateur annule
                    case 'auth/unauthorized-domain':
                        errorMessage = 'Domaine non autorisé. Contactez l\'administrateur.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Connexion Google non activée.';
                        break;
                    case 'auth/api-key-not-valid':
                        errorMessage = 'Clé API Firebase invalide.';
                        break;
                    default:
                        errorMessage = `Erreur: ${error.message}`;
                }
                
                showNotification(errorMessage, 'error');
                updateSyncStatus('❌ Erreur');
            }
        });

        // Déconnexion
        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut().then(() => {
                console.log('✅ Déconnexion réussie');
                userData = {};
                showNotification('Déconnecté avec succès', 'info');
            }).catch((error) => {
                console.error('❌ Erreur déconnexion:', error);
                showNotification('Erreur lors de la déconnexion', 'error');
            });
        });

        // Réinitialisation des données
        document.getElementById('resetDataBtn').addEventListener('click', async () => {
            if (!currentUser || !confirm('Êtes-vous sûr de vouloir réinitialiser toutes vos données ?')) return;
            
            try {
                console.log('🔄 Réinitialisation des données...');
                updateSyncStatus('🔄 Réinit...');
                
                // Supprimer toutes les collections existantes
                for (const category of categories) {
                    const snapshot = await db.collection('users')
                        .doc(currentUser.uid)
                        .collection(category)
                        .get();
                    
                    const deletePromises = [];
                    snapshot.forEach(doc => {
                        deletePromises.push(doc.ref.delete());
                    });
                    await Promise.all(deletePromises);
                }
                
                // Réinitialiser avec les données par défaut
                await initializeUserData();
                renderData();
                
                updateSyncStatus('✅ Réinitialisé');
                showNotification('Données réinitialisées avec succès!', 'success');
                
                setTimeout
