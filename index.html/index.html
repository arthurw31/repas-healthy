<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner Pro</title>
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Smart Meal Planning Platform">
    
    <!-- PWA Manifest -->
    <link rel="manifest" data-href="data:application/json;base64,ewogICJuYW1lIjogIk1lYWwgUGxhbm5lciBQcm8iLAogICJzaG9ydF9uYW1lIjogIk1lYWxQcm8iLAogICJkZXNjcmlwdGlvbiI6ICJBSS1Qb3dlcmVkIE1lYWwgUGxhbm5pbmcgUGxhdGZvcm0iLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMTcyYSIsCiAgInRoZW1lX2NvbG9yIjogIiMwZjE3MmEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2QybGtkR2c5SWpFeU9DSWlJR2hsYVdkb2REMGlNVEk0SWlCbWFXeHNQU0lqTUdZeE56SmhJaTgrUEhSbGVIUWdlRDBpTmpRaUlIazlJalkwSWlCbWIyNTBMV1poYldsc2VUMGlRWEpwWVd3aUlHWnZiblF0YzJsNlpUMGlNelppSWlCbWFXeHNQU0lqWm1abVptWm1JajQ0WXo4dkszUmxlSFErUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzBmMTcyYSIvPjx0ZXh0IHg9IjY0IiB5PSI2NCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjM2IiBmaWxsPSIjZmZmZmZmIj7wn42dPC90ZXh0Pjwvc3ZnPg==">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f8fafc;
            --accent: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 25%, #e2e8f0 50%, #cbd5e1 75%, #94a3b8 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Navigation */
        .nav {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 80px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .nav-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .nav-actions {
                gap: 8px;
            }
            
            .nav-actions .btn {
                padding: 12px 18px;
                font-size: 13px;
                font-weight: 600;
                width: auto;
                max-width: none;
            }
        }
        
        /* Hero Section */
        .hero {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 100px 24px 140px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.25) 0%, transparent 50%);
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        .hero h1 {
            font-size: 4.5rem;
            font-weight: 900;
            color: #1f2937;
            margin-bottom: 24px;
            letter-spacing: -0.025em;
            line-height: 1.1;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .hero p {
            font-size: 1.4rem;
            color: #374151;
            margin-bottom: 40px;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .hero-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 16px 32px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 15px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 50%, #e2e8f0 100%);
            color: #1f2937;
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(255, 255, 255, 0.6);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(255, 255, 255, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 50%, #374151 100%);
            color: white;
            box-shadow: 0 15px 35px rgba(107, 114, 128, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(107, 114, 128, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 50%, #4b5563 100%);
            color: white;
            box-shadow: 0 15px 35px rgba(156, 163, 175, 0.3);
        }
        
        .btn-warning:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 50px rgba(156, 163, 175, 0.4);
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: -60px auto 0;
            padding: 0 24px 80px;
            position: relative;
            z-index: 10;
        }
        
        /* Random Result */
        .random-result {
            background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
            color: white;
            padding: 32px;
            border-radius: 20px;
            margin-bottom: 32px;
            text-align: center;
            display: none;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px -10px rgba(99, 102, 241, 0.4);
        }
        
        .random-result.show {
            display: block;
        }
        
        .random-result h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .menu-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .menu-item-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .menu-item-value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Main Dashboard */
        .dashboard {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        .dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(55, 65, 81, 0.9) 100%);
            backdrop-filter: blur(20px);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--gray-200);
        }
        
        .category-section {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            padding: 30px;
            min-height: 500px;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .category-section:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* Mobile - Maintenir les colonnes c√¥te √† c√¥te */
        @media (max-width: 768px) {
            .content-grid {
                display: flex;
                overflow-x: auto;
                gap: 16px;
                padding: 16px;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }
            
            .category-section {
                min-width: 280px;
                flex-shrink: 0;
                scroll-snap-align: start;
                border-radius: 20px;
                min-height: 400px;
                padding: 20px;
            }
        }
        
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
        }
        
        .category-emoji {
            font-size: 1.5rem;
        }
        
        .add-category-btn {
            background: var(--gray-100);
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            display: none;
            transition: all 0.2s ease;
        }
        
        .add-category-btn:hover {
            background: var(--gray-200);
        }
        
        .edit-mode .add-category-btn {
            display: block;
        }
        
        /* Items */
        .item {
            display: block;
            padding: 16px 20px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            user-select: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .item:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.6);
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }
        
        .item.selected {
            background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(191, 219, 254, 0.9) 100%);
            border: 2px solid #3b82f6;
            color: #1e40af;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }
        
        .delete-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: none;
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }
        
        .edit-mode .item:hover .delete-btn {
            display: block;
        }
        
        .add-item-btn {
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-50) 100%);
            border: 2px dashed var(--gray-300);
            color: var(--gray-500);
            text-align: center;
            padding: 16px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: none;
            transition: all 0.3s ease;
        }
        
        .edit-mode .add-item-btn {
            display: block;
        }
        
        .add-item-btn:hover {
            background: white;
            border-color: var(--gray-400);
            color: var(--gray-700);
        }
        
        .item-input {
            width: 100%;
            padding: 12px 16px;
            margin: 8px 0;
            border: 2px solid var(--accent);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
        }
        
        .item-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        /* Category specific colors */
        .category-section:nth-child(1) .item:hover { border-color: #ef4444; }
        .category-section:nth-child(2) .item:hover { border-color: #06b6d4; }
        .category-section:nth-child(3) .item:hover { border-color: #3b82f6; }
        .category-section:nth-child(4) .item:hover { border-color: #10b981; }
        .category-section:nth-child(5) .item:hover { border-color: #f59e0b; }
        .category-section:nth-child(6) .item:hover { border-color: #8b5cf6; }
        .category-section:nth-child(7) .item:hover { border-color: #ec4899; }
        
        /* Mobile - Gardez toujours les colonnes c√¥te √† c√¥te */
        @media (max-width: 1200px) {
            .content-grid {
                display: flex;
                overflow-x: auto;
                gap: 16px;
                padding: 16px;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
            }
            
            .category-section {
                min-width: 280px;
                flex-shrink: 0;
                scroll-snap-align: start;
                border-radius: 20px;
                min-height: 400px;
                padding: 20px;
            }
        }
        
        @media (max-width: 900px) {
            .category-section {
                min-width: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero {
                padding: 60px 16px 80px;
            }
            
            .container {
                padding: 0 16px 60px;
                margin-top: -40px;
            }
            
            .nav-content {
                padding: 0 16px;
                height: 80px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                padding: 20px 24px;
                flex-direction: column;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }
            
            .category-section {
                min-height: 300px;
            }
        }
        
        .install-banner {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 32px;
            text-align: center;
            display: none;
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.3);
        }
        
        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Simple auth overlay - minimal style */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .auth-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .auth-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .auth-overlay.show .auth-box {
            transform: scale(1);
        }

        .auth-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 20px;
            color: #1f2937;
        }

        .google-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .google-btn:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }

        /* Styles pour les nouveaux √©l√©ments */
        .item.favorite {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 193, 7, 0.1) 100%);
            border-color: #ffd700;
        }
        
        .item.custom {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            border-left: 4px solid #10b981;
        }
        
        .favorite-icon {
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <!-- Simple auth overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-box">
            <h2 class="auth-title">üçΩÔ∏è MealPro</h2>
            <p style="color: #6b7280; margin-bottom: 30px;">Connectez-vous pour synchroniser vos donn√©es</p>
            
            <button class="google-btn" id="googleSignIn">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continuer avec Google
            </button>
            
            <p style="font-size: 12px; color: #9ca3af;">
                Vos donn√©es seront synchronis√©es en toute s√©curit√©
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#" class="logo">üçΩÔ∏è MealPro</a>
            <div class="nav-actions">
                <span class="sync-indicator" id="syncStatus" style="display: none;">‚úÖ Synchronis√©</span>
                <button class="btn btn-secondary" id="logoutBtn" style="display: none; font-size: 12px; padding: 8px 16px;">
                    üö™ D√©co
                </button>
                <button class="btn btn-primary" id="resetDataBtn" style="display: none; font-size: 12px; padding: 8px 16px; background: #f59e0b;">
                    üîÑ R√©init
                </button>
                <button class="btn btn-success" id="randomMenuBtn">
                    üé≤ Generate Menu
                </button>
                <button class="btn btn-warning edit-toggle" id="editToggle">
                    ‚úèÔ∏è Edit Mode
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Plan. Cook. Enjoy</h1>
            <p>Smart meal planning that adapts to your lifestyle. Create healthy, delicious meals with zero hassle.</p>
        </div>
    </section>

    <!-- Main Container -->
    <div class="container">
        <!-- Install Banner -->
        <div class="install-banner" id="installBanner">
            üì± Install this app on your device for quick access!
            <button class="install-btn" id="installBtn">Install Now</button>
        </div>

        <!-- Random Result -->
        <div class="random-result" id="randomResult">
            <h3>üéØ Your Personalized Menu</h3>
            <div class="menu-items" id="menuContent"></div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <div class="dashboard-header">
                <div class="dashboard-title">Meal Planning Dashboard</div>
                <div class="dashboard-actions">
                    <span style="font-size: 14px; opacity: 0.8;">üí° Double-cliquez sur un √©l√©ment pour des recettes</span>
                </div>
            </div>

            <div class="content-grid">
                <div class="category-section" data-category="entrees">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">ü•ó</span>
                            Entr√©e
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une entr√©e</div>
                </div>

                <div class="category-section" data-category="sauces">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">ü•Ñ</span>
                            Base Sauce
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une base sauce</div>
                </div>

                <div class="category-section" data-category="proteines">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">üçñ</span>
                            Prot√©ine
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une prot√©ine</div>
                </div>

                <div class="category-section" data-category="glucides">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">üåæ</span>
                            F√©culent
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter un f√©culent</div>
                </div>

                <div class="category-section" data-category="legumes">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">ü•¨</span>
                            L√©gumes
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter des l√©gumes</div>
                </div>

                <div class="category-section" data-category="cuissons">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">‚ö°</span>
                            Technique Cuisson
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter une technique</div>
                </div>

                <div class="category-section" data-category="desserts">
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-emoji">üç®</span>
                            Dessert
                        </div>
                        <button class="add-category-btn">+ Add</button>
                    </div>
                    <div class="add-item-btn">+ Ajouter un dessert</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration Firebase - CL√âS CORRIG√âES
        const firebaseConfig = {
            apiKey: "AIzaSyDunACCEQRqr4jglsPl6BUy_Gs5SCTqKuw",
            authDomain: "mealpro-4a148.firebaseapp.com",
            projectId: "mealpro-4a148",
            storageBucket: "mealpro-4a148.firebasestorage.app",
            messagingSenderId: "480098718071",
            appId: "1:480098718071:web:e746015ce5c8557adcd172",
            measurementId: "G-Q2XD8SVTJQ"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Variables globales
        let currentUser = null;
        let editMode = false;
        let menusGenerated = parseInt(localStorage.getItem('menusGenerated')) || 0;

        // Donn√©es initiales
        const initialData = {
            entrees: ["Soupe froide", "Gaspacho", "Velout√©", "Soupe miso", "Bouillon", "Consomm√©", "Salade verte", "Salade compos√©e", "Salade de c√©r√©ales", "Bowl cru", "Crudit√©s", "Carpaccio", "Tartare", "Ceviche", "Hummus", "Guacamole", "Baba ganoush", "Tapenade", "Dips", "Mousse", "Terrine"],
            sauces: ["Base fromage blanc", "Base yaourt grec", "Base sauce soja", "Base miso", "Base tahini", "Mayo avocat", "Mayo yaourt", "Vinaigrette classique", "Vinaigrette asiatique", "Pesto", "Chimichurri", "Sauce verte", "Sauce √©pic√©e", "Sauce cr√©meuse", "Marinade", "√âmulsion"],
            proteines: ["Grill√©", "Air fryer", "Marin√©", "Mi-cuit", "Fum√©", "Vapeur", "Papillote", "Saut√©", "Po√™l√©", "Effiloch√©", "Mollet", "Brouill√©", "En omelette", "Confit", "Cru", "Slow cook", "Sous-vide", "R√¥ti", "Brais√©", "En sauce", "Pan√©", "Laqu√©"],
            glucides: ["Riz complet", "Riz noir", "Riz rouge", "Quinoa", "Boulgour", "√âpeautre", "Sarrasin", "Farro", "Orge", "Millet", "Avoine sal√©e", "P√¢tes compl√®tes", "P√¢tes l√©gumineuses", "Shiratakis", "Patate douce", "Pommes de terre", "Courge", "Riz de chou-fleur", "Courgetti", "Pain complet", "Galettes", "Polenta"],
            legumes: ["Vapeur", "Air fryer", "Grill√©s", "R√¥tis four", "Po√™l√©s", "Saut√©s wok", "Brais√©s", "Confits", "Papillote", "Crus", "Mass√©s", "Marin√©s", "Lacto-ferment√©s", "Pickles", "Glac√©s", "√Ä l'√©touff√©e", "Tempura", "Fum√©s", "En soupe", "En pur√©e", "En chips", "Spiral√©s"],
            cuissons: ["Air Fryer 180¬∞C", "Plancha haute temp√©rature", "Grill/Barbecue", "Po√™le antiadh√©sive", "Wok saut√© rapide", "Four 200¬∞C chaleur tournante", "Four vapeur 85¬∞C", "Cuisson vapeur douce", "Papillote herm√©tique", "Pochage eau fr√©missante", "Marinade √† froid", "Sous-vide basse temp√©rature", "Smoking fumage l√©ger", "Searing haute temp√©rature", "Braisage cocotte", "Slow cooking mijoteuse", "Fermentation lactique", "D√©shydratation", "Cru marin√© acidul√©", "Confit huile d'olive"],
            desserts: ["Nice cream", "Chia pudding", "Mousse", "Yaourt grec", "Skyr", "Fromage blanc", "Compote", "Fruits poch√©s", "Salade de fruits", "Energy balls", "Bark chocolat", "Smoothie bowl", "Panna cotta", "Tiramis√π", "Cheesecake cru", "Tarte crue", "Muffins", "Cookies", "Granola", "Parfait", "Sorbet", "Pudding"]
        };

        // Chargement des donn√©es depuis le stockage local ou utilisation des donn√©es initiales
        let userData = JSON.parse(localStorage.getItem('mealPlannerData')) || JSON.parse(JSON.stringify(initialData));

        // Authentification Google
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.addScope('email');
        googleProvider.addScope('profile');

        // Gestion de l'√©tat d'authentification avec synchronisation automatique
        auth.onAuthStateChanged(async (user) => {
            console.log('√âtat d\'authentification chang√©:', user ? user.email : 'non connect√©');
            currentUser = user;
            
            if (user) {
                // Utilisateur connect√©
                console.log('Utilisateur connect√©:', user.email);
                document.getElementById('authOverlay').classList.remove('show');
                document.getElementById('syncStatus').style.display = 'inline';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('resetDataBtn').style.display = 'inline-block';
                document.getElementById('syncStatus').textContent = '‚è≥ Chargement...';
                
                try {
                    // Charger les donn√©es depuis Firebase avec force refresh
                    await loadUserDataFresh();
                    renderData();
                    document.getElementById('syncStatus').textContent = '‚úÖ Synchronis√©';
                    console.log('Donn√©es charg√©es avec succ√®s');
                } catch (error) {
                    console.error('Erreur lors du chargement des donn√©es:', error);
                    document.getElementById('syncStatus').textContent = '‚ùå Erreur';
                    // Utiliser les donn√©es locales en cas d'erreur
                    loadUserDataFromLocal();
                    renderData();
                }
            } else {
                // Utilisateur non connect√©
                console.log('Utilisateur non connect√© - affichage overlay');
                document.getElementById('authOverlay').classList.add('show');
                document.getElementById('syncStatus').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
                
                // Utiliser les donn√©es locales
                loadUserDataFromLocal();
                renderData();
            }
        });

        // Charger les donn√©es avec diagnostic complet
        async function loadUserDataFresh() {
            if (!currentUser) return;
            
            try {
                console.log('üîÑ Chargement frais des donn√©es depuis Firebase...');
                console.log('üë§ User ID:', currentUser.uid);
                
                // Vider les donn√©es locales d'abord
                userData = {};
                
                // Charger les infos utilisateur
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                console.log('üìÑ Document utilisateur existe:', userDoc.exists);
                
                if (userDoc.exists) {
                    const userDocData = userDoc.data();
                    console.log('üìä Donn√©es utilisateur:', userDocData);
                    menusGenerated = userDocData.menusGenerated || 0;
                    
                    // V√âRIFIER D'ABORD L'ANCIENNE STRUCTURE
                    if (userDocData.data) {
                        console.log('üîç ANCIENNE STRUCTURE D√âTECT√âE!');
                        console.log('üì¶ Donn√©es dans "data":', userDocData.data);
                        
                        // Migrer depuis l'ancienne structure
                        const oldData = userDocData.data;
                        Object.keys(oldData).forEach(category => {
                            userData[category] = oldData[category].map((name, index) => ({
                                id: 'migrated-' + Date.now() + '-' + index,
                                name: name,
                                isFavorite: false,
                                isDefault: true,
                                createdAt: new Date(),
                                tags: []
                            }));
                            console.log(`üì¶ ${category}: ${userData[category].length} √©l√©ments migr√©s`);
                        });
                        
                        // Migrer vers la nouvelle structure
                        console.log('üîÑ Migration vers nouvelle structure...');
                        await migrateToNewStructure();
                        return;
                    }
                    
                    // NOUVELLE STRUCTURE - Charger les collections
                    const categories = Object.keys(initialData);
                    let totalItems = 0;
                    
                    for (const category of categories) {
                        console.log(`üì• Chargement de la cat√©gorie: ${category}`);
                        console.log(`üóÇÔ∏è Chemin: users/${currentUser.uid}/${category}`);
                        
                        try {
                            // Essayer SANS orderBy d'abord
                            const categorySnapshot = await db.collection('users')
                                .doc(currentUser.uid)
                                .collection(category)
                                .get();
                            
                            console.log(`üìä Documents trouv√©s dans ${category}: ${categorySnapshot.size}`);
                            
                            // Convertir les documents en array
                            userData[category] = [];
                            categorySnapshot.forEach(doc => {
                                const data = doc.data();
                                console.log(`üìÑ Document ${doc.id}:`, data);
                                userData[category].push({
                                    id: doc.id,
                                    name: data.name,
                                    isFavorite: data.isFavorite || false,
                                    isDefault: data.isDefault || false,
                                    createdAt: data.createdAt,
                                    tags: data.tags || []
                                });
                            });
                            
                            totalItems += userData[category].length;
                            console.log(`‚úÖ ${category}: ${userData[category].length} √©l√©ments charg√©s`);
                            
                        } catch (error) {
                            console.error(`‚ùå Erreur chargement ${category}:`, error);
                            userData[category] = [];
                        }
                    }
                    
                    console.log(`üìä Total des √©l√©ments charg√©s: ${totalItems}`);
                    
                    // Si aucun √©l√©ment trouv√©, r√©initialiser
                    if (totalItems === 0) {
                        console.log('‚ö†Ô∏è Aucun √©l√©ment trouv√©, r√©initialisation...');
                        await initializeUserData();
                        await loadUserDataFresh();
                        return;
                    }
                    
                    // Sauvegarder localement pour cache
                    saveDataLocal();
                    
                } else {
                    // Nouveau utilisateur - initialiser
                    console.log('üÜï Nouvel utilisateur d√©tect√©');
                    await initializeUserData();
                    await loadUserDataFresh();
                    return;
                }
            } catch (error) {
                console.error('‚ùå Erreur chargement frais:', error);
                throw error;
            }
        }

        // Fonction de migration depuis l'ancienne structure
        async function migrateToNewStructure() {
            if (!currentUser) return;
            
            try {
                console.log('üîÑ Migration vers nouvelle structure...');
                
                const categories = Object.keys(userData);
                for (const category of categories) {
                    console.log(`üì§ Migration de ${category}...`);
                    
                    const categoryRef = db.collection('users').doc(currentUser.uid).collection(category);
                    
                    for (const item of userData[category]) {
                        await categoryRef.add({
                            name: item.name,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            isFavorite: item.isFavorite || false,
                            isDefault: item.isDefault || true,
                            tags: item.tags || []
                        });
                    }
                    
                    console.log(`‚úÖ ${category} migr√© (${userData[category].length} √©l√©ments)`);
                }
                
                // Supprimer l'ancienne structure
                await db.collection('users').doc(currentUser.uid).update({
                    data: firebase.firestore.FieldValue.delete()
                });
                
                console.log('üéâ Migration termin√©e avec succ√®s!');
                showNotification('Migration des donn√©es termin√©e!', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur migration:', error);
            }
        }

        // Charger depuis les donn√©es locales (fallback)
        function loadUserDataFromLocal() {
            try {
                const localData = localStorage.getItem('mealPlannerData');
                if (localData) {
                    const simpleData = JSON.parse(localData);
                    userData = {};
                    
                    Object.keys(simpleData).forEach(category => {
                        userData[category] = simpleData[category].map(name => ({
                            id: 'local-' + Date.now() + Math.random(),
                            name: name,
                            isFavorite: false,
                            isDefault: true,
                            createdAt: new Date(),
                            tags: []
                        }));
                    });
                    
                    console.log('üì± Donn√©es locales charg√©es');
                } else {
                    // Utiliser les donn√©es par d√©faut
                    userData = {};
                    Object.keys(initialData).forEach(category => {
                        userData[category] = initialData[category].map(name => ({
                            id: 'default-' + Date.now() + Math.random(),
                            name: name,
                            isFavorite: false,
                            isDefault: true,
                            createdAt: new Date(),
                            tags: []
                        }));
                    });
                    console.log('üè† Donn√©es par d√©faut charg√©es');
                }
                
                menusGenerated = parseInt(localStorage.getItem('menusGenerated')) || 0;
            } catch (error) {
                console.error('‚ùå Erreur chargement local:', error);
            }
        }

        // Fonction de d√©connexion (sans bouton sync)
        function signOut() {
            auth.signOut().then(() => {
                console.log('D√©connexion r√©ussie');
                // Vider les donn√©es locales
                userData = {};
                localStorage.removeItem('mealPlannerData');
                loadUserDataFromLocal();
                renderData();
                showNotification('D√©connect√© avec succ√®s', 'info');
            }).catch((error) => {
                console.error('Erreur d√©connexion:', error);
                showNotification('Erreur lors de la d√©connexion', 'error');
            });
        }

        // Fonction de r√©initialisation des donn√©es
        async function resetUserData() {
            if (!currentUser) return;
            
            try {
                console.log('üîÑ R√©initialisation des donn√©es...');
                document.getElementById('syncStatus').textContent = 'üîÑ R√©init...';
                
                // Supprimer toutes les collections existantes
                const categories = Object.keys(initialData);
                for (const category of categories) {
                    const snapshot = await db.collection('users')
                        .doc(currentUser.uid)
                        .collection(category)
                        .get();
                    
                    const deletePromises = [];
                    snapshot.forEach(doc => {
                        deletePromises.push(doc.ref.delete());
                    });
                    await Promise.all(deletePromises);
                }
                
                // R√©initialiser avec les donn√©es par d√©faut
                await initializeUserData();
                
                // Recharger
                await loadUserDataFresh();
                renderData();
                
                document.getElementById('syncStatus').textContent = '‚úÖ R√©initialis√©';
                showNotification('Donn√©es r√©initialis√©es avec succ√®s!', 'success');
                
                setTimeout(() => {
                    document.getElementById('syncStatus').textContent = '‚úÖ Synchronis√©';
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Erreur r√©initialisation:', error);
                showNotification('Erreur lors de la r√©initialisation', 'error');
            }
        }

        // Event listeners
        document.getElementById('logoutBtn').addEventListener('click', signOut);
        document.getElementById('resetDataBtn').addEventListener('click', resetUserData);

        // Connexion Google avec gestion mobile am√©lior√©e
        document.getElementById('googleSignIn').addEventListener('click', async () => {
            try {
                console.log('Tentative de connexion Google...');
                
                // V√©rifier si Firebase est initialis√©
                if (!firebase.apps.length) {
                    throw new Error('Firebase non initialis√©');
                }

                // Configuration pour mobile
                googleProvider.setCustomParameters({
                    prompt: 'select_account' // Force la s√©lection de compte
                });
                
                // Tentative de connexion
                const result = await auth.signInWithPopup(googleProvider);
                console.log('Connexion r√©ussie:', result.user.email);
                
                // Forcer le rechargement des donn√©es
                setTimeout(async () => {
                    await forceRefreshData();
                }, 1000);
                
                // V√©rifier si c'est un nouvel utilisateur
                if (result.additionalUserInfo.isNewUser) {
                    console.log('Nouvel utilisateur - initialisation des donn√©es');
                    await initializeUserData();
                }
            } catch (error) {
                console.error('Erreur de connexion d√©taill√©e:', error);
                console.error('Code d\'erreur:', error.code);
                console.error('Message d\'erreur:', error.message);
                
                let errorMessage = 'Erreur de connexion inconnue';
                
                switch(error.code) {
                    case 'auth/popup-blocked':
                        errorMessage = 'Popup bloqu√©. Autorisez les popups pour ce site.';
                        break;
                    case 'auth/popup-closed-by-user':
                        errorMessage = 'Connexion annul√©e.';
                        break;
                    case 'auth/unauthorized-domain':
                        errorMessage = 'Domaine non autoris√©. Contactez l\'administrateur.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Connexion Google non activ√©e.';
                        break;
                    default:
                        errorMessage = `Erreur: ${error.message}`;
                }
                
                alert(errorMessage);
            }
        });

        // Initialiser les donn√©es utilisateur dans Firebase avec structure organis√©e
        async function initializeUserData() {
            if (!currentUser) return;
            
            try {
                console.log('Initialisation des donn√©es utilisateur...');
                
                // Cr√©er le document utilisateur principal
                await db.collection('users').doc(currentUser.uid).set({
                    email: currentUser.email,
                    displayName: currentUser.displayName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    menusGenerated: menusGenerated,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Cr√©er les collections pour chaque cat√©gorie
                const categories = Object.keys(initialData);
                
                for (const category of categories) {
                    console.log(`Initialisation de la cat√©gorie: ${category}`);
                    
                    // Cr√©er une sous-collection pour chaque cat√©gorie
                    const categoryRef = db.collection('users').doc(currentUser.uid).collection(category);
                    
                    // Ajouter chaque √©l√©ment de la cat√©gorie
                    for (const item of initialData[category]) {
                        await categoryRef.add({
                            name: item,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            isFavorite: false,
                            isDefault: true, // Marquer les √©l√©ments par d√©faut
                            tags: []
                        });
                    }
                }
                
                console.log('Initialisation termin√©e avec succ√®s');
            } catch (error) {
                console.error('Erreur initialisation:', error);
            }
        }

        // Charger les donn√©es utilisateur depuis Firebase avec nouvelle structure
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                console.log('Chargement des donn√©es utilisateur...');
                
                // Charger les infos utilisateur
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    menusGenerated = userData.menusGenerated || 0;
                    
                    // Charger chaque cat√©gorie depuis ses sous-collections
                    const categories = Object.keys(initialData);
                    
                    for (const category of categories) {
                        console.log(`Chargement de la cat√©gorie: ${category}`);
                        
                        const categorySnapshot = await db.collection('users')
                            .doc(currentUser.uid)
                            .collection(category)
                            .orderBy('createdAt', 'asc')
                            .get();
                        
                        // Convertir les documents en array simple pour compatibilit√©
                        userData[category] = [];
                        categorySnapshot.forEach(doc => {
                            const data = doc.data();
                            userData[category].push({
                                id: doc.id,
                                name: data.name,
                                isFavorite: data.isFavorite || false,
                                isDefault: data.isDefault || false,
                                createdAt: data.createdAt,
                                tags: data.tags || []
                            });
                        });
                    }
                    
                    console.log('Donn√©es charg√©es:', userData);
                } else {
                    // Nouveau utilisateur - initialiser
                    console.log('Nouvel utilisateur d√©tect√©');
                    await initializeUserData();
                    await loadUserData(); // Recharger apr√®s initialisation
                    return;
                }
            } catch (error) {
                console.error('Erreur chargement:', error);
                // Fallback vers les donn√©es par d√©faut
                Object.keys(initialData).forEach(category => {
                    userData[category] = initialData[category].map(name => ({
                        id: Date.now() + Math.random(),
                        name: name,
                        isFavorite: false,
                        isDefault: true,
                        createdAt: new Date(),
                        tags: []
                    }));
                });
            }
        }

        // Sauvegarder les donn√©es avec nouvelle structure
        async function saveData() {
            // Toujours sauvegarder localement (format simple pour compatibilit√©)
            const simpleData = {};
            Object.keys(userData).forEach(category => {
                simpleData[category] = userData[category].map(item => 
                    typeof item === 'string' ? item : item.name
                );
            });
            localStorage.setItem('mealPlannerData', JSON.stringify(simpleData));
            localStorage.setItem('menusGenerated', menusGenerated.toString());
            
            // Sauvegarder dans Firebase si connect√©
            if (currentUser) {
                try {
                    document.getElementById('syncStatus').textContent = '‚è≥ Sync...';
                    
                    // Mettre √† jour le compteur de menus
                    await db.collection('users').doc(currentUser.uid).update({
                        menusGenerated: menusGenerated,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    document.getElementById('syncStatus').textContent = '‚úÖ Synchronis√©';
                } catch (error) {
                    console.error('Erreur sync:', error);
                    document.getElementById('syncStatus').textContent = '‚ùå Erreur sync';
                    
                    setTimeout(() => {
                        document.getElementById('syncStatus').textContent = '‚úÖ Local';
                    }, 3000);
                }
            }
        }

        // Ajouter un nouvel √©l√©ment dans une cat√©gorie (avec debug)
        async function addItemToCategory(category, itemName) {
            if (!itemName.trim()) return false;
            
            try {
                console.log(`Tentative d'ajout: "${itemName}" dans ${category}`);
                
                if (currentUser) {
                    // Ajouter √† Firestore
                    const docRef = await db.collection('users')
                        .doc(currentUser.uid)
                        .collection(category)
                        .add({
                            name: itemName.trim(),
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            isFavorite: false,
                            isDefault: false,
                            tags: []
                        });
                    
                    console.log(`√âl√©ment ajout√© √† Firestore avec ID: ${docRef.id}`);
                }
                
                // Ajouter localement pour affichage imm√©diat
                if (!userData[category]) userData[category] = [];
                userData[category].push({
                    id: currentUser ? 'temp-' + Date.now() : 'local-' + Date.now(),
                    name: itemName.trim(),
                    isFavorite: false,
                    isDefault: false,
                    createdAt: new Date(),
                    tags: []
                });
                
                console.log(`√âl√©ment "${itemName}" ajout√© localement √† ${category}`);
                return true;
            } catch (error) {
                console.error('Erreur ajout √©l√©ment:', error);
                return false;
            }
        }

        // Supprimer un √©l√©ment d'une cat√©gorie (VERSION CORRIG√âE)
        async function deleteItemFromCategory(category, itemId, itemName) {
            try {
                console.log(`üóëÔ∏è Suppression Firebase: "${itemName}" (ID: ${itemId}) de ${category}`);
                
                if (currentUser) {
                    // Si on a un ID sp√©cifique, l'utiliser
                    if (itemId && itemId !== 'local' && !itemId.startsWith('temp-')) {
                        console.log(`üî• Suppression directe par ID: ${itemId}`);
                        await db.collection('users')
                            .doc(currentUser.uid)
                            .collection(category)
                            .doc(itemId)
                            .delete();
                        console.log('‚úÖ Suppression par ID r√©ussie');
                    } else {
                        // Sinon, chercher par nom
                        console.log(`üîç Recherche par nom: "${itemName}"`);
                        const snapshot = await db.collection('users')
                            .doc(currentUser.uid)
                            .collection(category)
                            .where('name', '==', itemName)
                            .get();
                        
                        console.log(`üìä Documents trouv√©s: ${snapshot.size}`);
                        
                        if (!snapshot.empty) {
                            const deletePromises = [];
                            snapshot.forEach(doc => {
                                console.log(`üóëÔ∏è Suppression document ID: ${doc.id}, name: ${doc.data().name}`);
                                deletePromises.push(doc.ref.delete());
                            });
                            
                            await Promise.all(deletePromises);
                            console.log('‚úÖ Suppression par nom r√©ussie');
                        } else {
                            console.log('‚ö†Ô∏è Aucun document trouv√© avec ce nom');
                        }
                    }
                }
                
                // Supprimer localement
                if (userData[category]) {
                    const initialLength = userData[category].length;
                    userData[category] = userData[category].filter(item => {
                        const name = typeof item === 'string' ? item : item.name;
                        return name !== itemName;
                    });
                    
                    console.log(`üìä √âl√©ments locaux: ${initialLength} ‚Üí ${userData[category].length}`);
                    return userData[category].length < initialLength;
                }
                
                return false;
            } catch (error) {
                console.error('‚ùå Erreur suppression Firebase:', error);
                return false;
            }
        }

        // G√©n√©rer un menu al√©atoire avec nouvelle structure
        function generateRandomMenu() {
            const menu = {};
            const menuLabels = {
                entrees: "ü•ó Entr√©e",
                sauces: "ü•Ñ Base Sauce", 
                proteines: "üçñ Prot√©ine",
                glucides: "üåæ F√©culent",
                legumes: "ü•¨ L√©gumes", 
                cuissons: "‚ö° Technique Cuisson",
                desserts: "üç® Dessert"
            };
            
            Object.keys(userData).forEach(category => {
                if (userData[category] && userData[category].length > 0) {
                    const randomIndex = Math.floor(Math.random() * userData[category].length);
                    const selectedItem = userData[category][randomIndex];
                    const itemName = typeof selectedItem === 'string' ? selectedItem : selectedItem.name;
                    menu[category] = itemName;
                }
            });
            
            const menuContent = document.getElementById('menuContent');
            const randomResult = document.getElementById('randomResult');
            
            let menuHTML = '';
            Object.keys(menu).forEach(category => {
                menuHTML += `
                    <div class="menu-item" ondblclick="searchRecipeWithCategory('${menu[category].replace(/'/g, "\\'")}', '${category}')">
                        <div class="menu-item-label">${menuLabels[category]}</div>
                        <div class="menu-item-value">${menu[category]}</div>
                    </div>
                `;
            });
            
            menuContent.innerHTML = menuHTML;
            randomResult.classList.add('show');
            
            // Mise √† jour du compteur
            menusGenerated++;
            saveData();
            
            // Scroll vers le r√©sultat
            randomResult.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Event listener pour le bouton menu al√©atoire
        document.getElementById('randomMenuBtn').addEventListener('click', generateRandomMenu);

        // Fonction de suppression simplifi√©e et forc√©e
        async function deleteItemSimple(itemName, category) {
            console.log(`üóëÔ∏è deleteItemSimple: "${itemName}" de ${category}`);
            
            if (currentUser) {
                try {
                    console.log(`üîç Recherche de "${itemName}" dans Firebase...`);
                    
                    // M√©thode 1: Recherche par nom exact
                    const snapshot = await db.collection('users')
                        .doc(currentUser.uid)
                        .collection(category)
                        .where('name', '==', itemName)
                        .get();
                    
                    console.log(`üìä Documents trouv√©s avec nom exact: ${snapshot.size}`);
                    
                    if (!snapshot.empty) {
                        // Supprimer tous les documents trouv√©s
                        const deletePromises = [];
                        snapshot.forEach(doc => {
                            console.log(`üóëÔ∏è Suppression doc ID: ${doc.id}, data:`, doc.data());
                            deletePromises.push(doc.ref.delete());
                        });
                        
                        await Promise.all(deletePromises);
                        console.log(`‚úÖ ${deletePromises.length} document(s) supprim√©(s) de Firebase`);
                    } else {
                        console.log(`‚ö†Ô∏è Aucun document trouv√© avec le nom "${itemName}"`);
                        
                        // M√©thode 2: Lister TOUS les documents et chercher manuellement
                        console.log('üîç Recherche manuelle dans tous les documents...');
                        const allDocs = await db.collection('users')
                            .doc(currentUser.uid)
                            .collection(category)
                            .get();
                        
                        console.log(`üìä Total documents dans ${category}: ${allDocs.size}`);
                        
                        allDocs.forEach(doc => {
                            const data = doc.data();
                            console.log(`üìÑ Doc ${doc.id}:`, data);
                            
                            // Comparaison flexible
                            if (data.name === itemName || 
                                data.name?.toLowerCase() === itemName.toLowerCase() ||
                                data.name?.trim() === itemName.trim()) {
                                console.log(`üéØ MATCH trouv√©! Suppression de ${doc.id}`);
                                doc.ref.delete();
                            }
                        });
                    }
                } catch (error) {
                    console.error('‚ùå Erreur suppression Firebase:', error);
                }
            }
            
            // Suppression locale
            if (!userData[category]) {
                console.log(`‚ùå Cat√©gorie ${category} non trouv√©e localement`);
                return;
            }
            
            const initialLength = userData[category].length;
            userData[category] = userData[category].filter(item => {
                const name = typeof item === 'string' ? item : item.name;
                return name !== itemName;
            });
            
            if (userData[category].length < initialLength) {
                console.log(`‚úÖ √âl√©ment "${itemName}" supprim√© localement`);
                saveDataLocal();
                renderData();
                showNotification(`"${itemName}" supprim√©`, 'success');
            } else {
                console.log('‚ùå √âl√©ment non trouv√© localement');
            }
        }

        // Fonction pour lister tous les √©l√©ments Firebase (debug)
        async function debugListFirebaseItems(category) {
            if (!currentUser) {
                console.log('‚ùå Pas d\'utilisateur connect√©');
                return;
            }
            
            try {
                console.log(`üîç === DEBUG ${category.toUpperCase()} ===`);
                
                const snapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection(category)
                    .get();
                
                console.log(`üìä Total documents dans ${category}: ${snapshot.size}`);
                
                snapshot.forEach((doc, index) => {
                    const data = doc.data();
                    console.log(`${index + 1}. ID: ${doc.id}`);
                    console.log(`   Nom: "${data.name}"`);
                    console.log(`   Cr√©√©: ${data.createdAt?.toDate()}`);
                    console.log(`   Favori: ${data.isFavorite}`);
                    console.log('   ---');
                });
                
                console.log(`üîç === FIN DEBUG ${category.toUpperCase()} ===`);
            } catch (error) {
                console.error(`‚ùå Erreur debug ${category}:`, error);
            }
        }

        // Ajouter le debug au window pour pouvoir l'appeler depuis la console
        window.debugFirebase = debugListFirebaseItems;

        // Debug du mode edit
        document.getElementById('editToggle').addEventListener('click', function() {
            editMode = !editMode;
            console.log(`üîß Mode edit chang√©: ${editMode}`);
            
            document.body.classList.toggle('edit-mode', editMode);
            this.textContent = editMode ? '‚úÖ Save Changes' : '‚úèÔ∏è Edit Mode';
            this.className = editMode ? 'btn btn-success' : 'btn btn-warning';
            
            if (!editMode) {
                saveData();
            }
            
            console.log('üé® Classes body:', document.body.className);
            console.log('üëÅÔ∏è Boutons d\'ajout visibles:', document.querySelectorAll('.add-item-btn').length);
        });

        // Rendu des donn√©es avec nouvelle structure
        function renderData() {
            Object.keys(userData).forEach(category => {
                const section = document.querySelector(`[data-category="${category}"]`);
                if (!section) return;
                
                const addBtn = section.querySelector('.add-item-btn');
                
                // Supprime les anciens items (sauf le bouton d'ajout)
                section.querySelectorAll('.item').forEach(item => item.remove());
                
                // Ajoute les nouveaux items
                if (userData[category]) {
                    userData[category].forEach(item => {
                        const itemName = typeof item === 'string' ? item : item.name;
                        const itemId = typeof item === 'string' ? 'local' : item.id;
                        const isFavorite = typeof item === 'string' ? false : item.isFavorite;
                        const isDefault = typeof item === 'string' ? true : item.isDefault;
                        
                        const itemEl = createItemElement(itemName, category, itemId, isFavorite, isDefault);
                        section.insertBefore(itemEl, addBtn);
                    });
                }
            });
        }

        // Cr√©ation d'un √©l√©ment item avec m√©tadonn√©es
        function createItemElement(text, category, itemId = 'local', isFavorite = false, isDefault = true) {
            const item = document.createElement('div');
            item.className = 'item';
            if (isFavorite) item.classList.add('favorite');
            if (!isDefault) item.classList.add('custom');
            
            // Contenu principal
            const content = document.createElement('span');
            content.className = 'item-content';
            content.textContent = text;
            item.appendChild(content);
            
            // Indicateur favori
            if (isFavorite) {
                const favoriteIcon = document.createElement('span');
                favoriteIcon.className = 'favorite-icon';
                favoriteIcon.innerHTML = '‚≠ê';
                favoriteIcon.style.cssText = 'position: absolute; top: 8px; right: 32px; font-size: 12px;';
                item.appendChild(favoriteIcon);
            }
            
            // Bouton de suppression (version debug)
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '√ó';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                console.log(`üóëÔ∏è Tentative de suppression: "${text}" de ${category}`);
                console.log('üîß Mode edit:', editMode);
                
                if (editMode) {
                    deleteItemSimple(text, category);
                } else {
                    console.log('‚ö†Ô∏è Mode edit non activ√© pour suppression');
                }
            });
            item.appendChild(deleteBtn);
            
            // S√©lection et recherche
            item.addEventListener('click', function() {
                if (!editMode) {
                    this.classList.toggle('selected');
                }
            });
            
            // Double-clic pour recherche web avec cat√©gorie
            item.addEventListener('dblclick', function() {
                if (!editMode) {
                    searchRecipeWithCategory(text, category);
                }
            });
            
            return item;
        }

        // Suppression d'un item (fonction corrig√©e)
        async function deleteItem(text, category) {
            // Trouver l'ID de l'√©l√©ment
            let itemId = 'local';
            if (userData[category]) {
                const item = userData[category].find(item => {
                    const name = typeof item === 'string' ? item : item.name;
                    return name === text;
                });
                if (item && typeof item === 'object') {
                    itemId = item.id;
                }
            }
            
            const success = await deleteItemFromCategory(category, itemId, text);
            if (success) {
                renderData();
                showNotification(`"${text}" supprim√©`, 'success');
            } else {
                showNotification('Erreur lors de la suppression', 'error');
            }
        }

        // Ajout d'un item (mise √† jour)
        function addItem(category) {
            const input = document.createElement('input');
            input.className = 'item-input';
            input.placeholder = 'Entrez un nouvel √©l√©ment...';
            
            const section = document.querySelector(`[data-category="${category}"]`);
            const addBtn = section.querySelector('.add-item-btn');
            section.insertBefore(input, addBtn);
            
            input.focus();
            
            const handleSave = async () => {
                const text = input.value.trim();
                if (text) {
                    // V√©rifier si l'√©l√©ment existe d√©j√†
                    const exists = userData[category] && userData[category].some(item => {
                        const name = typeof item === 'string' ? item : item.name;
                        return name.toLowerCase() === text.toLowerCase();
                    });
                    
                    if (!exists) {
                        const success = await addItemToCategory(category, text);
                        if (success) {
                            renderData();
                            showNotification(`"${text}" ajout√© avec succ√®s!`, 'success');
                        } else {
                            showNotification('Erreur lors de l\'ajout', 'error');
                        }
                    } else {
                        showNotification('Cet √©l√©ment existe d√©j√†', 'warning');
                    }
                }
                input.remove();
            };
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSave();
                }
            });
            
            input.addEventListener('blur', handleSave);
        }

        // Syst√®me de notifications am√©lior√©
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                error: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                warning: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                info: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
                animation: slideInRight 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Fonction de recherche avec cat√©gorie
        function searchRecipeWithCategory(ingredient, category) {
            const categoryTerms = {
                entrees: "entr√©e",
                sauces: "sauce",
                proteines: "prot√©ine",
                glucides: "f√©culent",
                legumes: "l√©gumes",
                cuissons: "cuisson",
                desserts: "dessert"
            };
            
            const categoryTerm = categoryTerms[category] || category;
            const searchQuery = `${categoryTerm} ${ingredient} healthy recette`;
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
            
            window.open(searchUrl, '_blank');
            showSearchFeedback(`${categoryTerm} ${ingredient}`);
        }
        
        // Fonction de recherche accessible globalement
        window.searchRecipeWithCategory = function(ingredient, category) {
            const categoryTerms = {
                entrees: "entr√©e",
                sauces: "sauce",
                proteines: "prot√©ine",
                glucides: "f√©culent", 
                legumes: "l√©gumes",
                cuissons: "cuisson",
                desserts: "dessert"
            };
            
            const categoryTerm = categoryTerms[category] || category;
            const searchQuery = `${categoryTerm} ${ingredient} healthy recette`;
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
            
            window.open(searchUrl, '_blank');
            showSearchFeedback(`${categoryTerm} ${ingredient}`);
        }
        
        // Feedback visuel pour la recherche
        function showSearchFeedback(ingredient) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--accent) 0%, #059669 100%);
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = `üîç Recherche: "${ingredient}"`;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Suppression d'un item
        function deleteItem(text, category) {
            const index = userData[category].indexOf(text);
            if (index > -1) {
                userData[category].splice(index, 1);
                renderData();
                saveData();
            }
        }

        // Ajout d'un item
        function addItem(category) {
            const input = document.createElement('input');
            input.className = 'item-input';
            input.placeholder = 'Enter new item...';
            
            const section = document.querySelector(`[data-category="${category}"]`);
            const addBtn = section.querySelector('.add-item-btn');
            section.insertBefore(input, addBtn);
            
            input.focus();
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const text = input.value.trim();
                    if (text && !userData[category].includes(text)) {
                        userData[category].push(text);
                        renderData();
                        saveData();
                    } else {
                        input.remove();
                    }
                }
            });
            
            input.addEventListener('blur', () => {
                const text = input.value.trim();
                if (text && !userData[category].includes(text)) {
                    userData[category].push(text);
                    renderData();
                    saveData();
                } else {
                    input.remove();
                }
            });
        }

        // Event listeners pour TOUS les boutons d'ajout (avec debug)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Initialisation des event listeners...');
            
            // Attendre un peu que le DOM soit compl√®tement charg√©
            setTimeout(() => {
                // Boutons d'ajout principaux (en bas)
                const addButtons = document.querySelectorAll('.add-item-btn');
                console.log(`üìù Trouv√© ${addButtons.length} boutons d'ajout principaux`);
                
                addButtons.forEach((btn, index) => {
                    console.log(`üéØ Configuration bouton principal ${index + 1}`);
                    
                    // Supprimer les anciens listeners
                    btn.replaceWith(btn.cloneNode(true));
                    const newBtn = document.querySelectorAll('.add-item-btn')[index];
                    
                    newBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const categoryElement = newBtn.closest('[data-category]');
                        const category = categoryElement ? categoryElement.dataset.category : null;
                        
                        console.log(`üéØ Clic sur bouton principal pour cat√©gorie: ${category}`);
                        
                        if (category) {
                            addItemSimple(category);
                        } else {
                            console.error('‚ùå Impossible de trouver la cat√©gorie');
                        }
                    });
                });

                // Boutons "+ Add" dans les headers
                const addCategoryButtons = document.querySelectorAll('.add-category-btn');
                console.log(`‚ûï Trouv√© ${addCategoryButtons.length} boutons "+ Add" dans les headers`);
                
                addCategoryButtons.forEach((btn, index) => {
                    console.log(`‚ûï Configuration bouton header ${index + 1}`);
                    
                    // Supprimer les anciens listeners
                    btn.replaceWith(btn.cloneNode(true));
                    const newBtn = document.querySelectorAll('.add-category-btn')[index];
                    
                    newBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const categoryElement = newBtn.closest('[data-category]');
                        const category = categoryElement ? categoryElement.dataset.category : null;
                        
                        console.log(`‚ûï Clic sur bouton "+ Add" pour cat√©gorie: ${category}`);
                        console.log('üîß Mode edit actuel:', editMode);
                        
                        if (category && editMode) {
                            addItemSimple(category);
                        } else if (!editMode) {
                            console.log('‚ö†Ô∏è Mode edit non activ√© pour bouton "+ Add"');
                            showNotification('Activez le mode Edit d\'abord', 'warning');
                        } else {
                            console.error('‚ùå Impossible de trouver la cat√©gorie pour "+ Add"');
                        }
                    });
                    
                    console.log(`‚úÖ Bouton "+ Add" ${index + 1} configur√© pour:`, newBtn.closest('[data-category]')?.dataset.category);
                });
                
            }, 1000);
        });

        // Version simplifi√©e de l'ajout d'√©l√©ment
        function addItemSimple(category) {
            console.log(`üöÄ addItemSimple appel√© pour: ${category}`);
            console.log('üë§ Utilisateur connect√©:', currentUser ? currentUser.email : 'Non connect√©');
            console.log('üìù Mode edit:', editMode);
            
            if (!editMode) {
                console.log('‚ö†Ô∏è Mode edit non activ√©');
                return;
            }
            
            const section = document.querySelector(`[data-category="${category}"]`);
            if (!section) {
                console.error(`‚ùå Section pour ${category} introuvable`);
                return;
            }
            
            const addBtn = section.querySelector('.add-item-btn');
            if (!addBtn) {
                console.error(`‚ùå Bouton d'ajout pour ${category} introuvable`);
                return;
            }
            
            console.log('‚úÖ Section et bouton trouv√©s, cr√©ation de l\'input...');
            
            // Cr√©er l'input
            const input = document.createElement('input');
            input.className = 'item-input';
            input.placeholder = 'Entrez un nouvel √©l√©ment...';
            input.style.display = 'block';
            input.style.width = '100%';
            
            // Ins√©rer l'input
            section.insertBefore(input, addBtn);
            input.focus();
            
            console.log('‚úÖ Input cr√©√© et ins√©r√©');
            
            // G√©rer la sauvegarde
            const handleSave = () => {
                const text = input.value.trim();
                console.log(`üíæ Tentative de sauvegarde: "${text}"`);
                
                if (text) {
                    // Ajouter directement aux donn√©es locales
                    if (!userData[category]) {
                        userData[category] = [];
                        console.log(`üìÅ Cat√©gorie ${category} initialis√©e`);
                    }
                    
                    // V√©rifier si existe d√©j√†
                    const exists = userData[category].some(item => {
                        const name = typeof item === 'string' ? item : item.name;
                        return name.toLowerCase() === text.toLowerCase();
                    });
                    
                    if (!exists) {
                        userData[category].push({
                            id: 'local-' + Date.now(),
                            name: text,
                            isFavorite: false,
                            isDefault: false,
                            createdAt: new Date(),
                            tags: []
                        });
                        
                        console.log(`‚úÖ √âl√©ment "${text}" ajout√© √† ${category}`);
                        console.log('üìä Donn√©es actuelles:', userData[category]);
                        
                        // Sauvegarder et recharger
                        saveDataLocal();
                        renderData();
                        showNotification(`"${text}" ajout√©!`, 'success');
                        
                        // Essayer de synchroniser avec Firebase si connect√©
                        if (currentUser) {
                            syncNewItemToFirebase(category, text);
                        }
                    } else {
                        console.log('‚ö†Ô∏è √âl√©ment existe d√©j√†');
                        showNotification('Cet √©l√©ment existe d√©j√†', 'warning');
                    }
                } else {
                    console.log('‚ö†Ô∏è Texte vide');
                }
                
                input.remove();
            };
            
            // Event listeners pour l'input
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    console.log('‚å®Ô∏è Touche Entr√©e press√©e');
                    handleSave();
                }
            });
            
            input.addEventListener('blur', () => {
                console.log('üëÅÔ∏è Input a perdu le focus');
                handleSave();
            });
        }

        // Sauvegarde locale simple
        function saveDataLocal() {
            try {
                const simpleData = {};
                Object.keys(userData).forEach(category => {
                    simpleData[category] = userData[category].map(item => 
                        typeof item === 'string' ? item : item.name
                    );
                });
                localStorage.setItem('mealPlannerData', JSON.stringify(simpleData));
                console.log('üíæ Donn√©es sauvegard√©es localement');
            } catch (error) {
                console.error('‚ùå Erreur sauvegarde locale:', error);
            }
        }

        // Synchronisation Firebase en arri√®re-plan
        async function syncNewItemToFirebase(category, itemName) {
            if (!currentUser) return;
            
            try {
                console.log(`üîÑ Synchronisation Firebase: ${itemName} ‚Üí ${category}`);
                await db.collection('users')
                    .doc(currentUser.uid)
                    .collection(category)
                    .add({
                        name: itemName,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        isFavorite: false,
                        isDefault: false,
                        tags: []
                    });
                console.log('‚úÖ Synchronisation Firebase r√©ussie');
            } catch (error) {
                console.error('‚ùå Erreur synchronisation Firebase:', error);
            }
        }

        // Initialisation
        renderData();

        // PWA Installation
        let deferredPrompt;
        const installBanner = document.getElementById('installBanner');
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                installBanner.style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            installBanner.style.display = 'none';
        });

        // Service Worker pour fonctionnement offline
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'meal-planner-pro-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('SW registered'))
                    .catch(() => console.log('SW registration failed'));
            });
        }

        // Fermer l'overlay en cliquant √† l'ext√©rieur
        document.getElementById('authOverlay').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                // Ne pas fermer - l'utilisateur doit se connecter pour utiliser l'app
                // document.getElementById('authOverlay').classList.remove('show');
            }
        });

        // Test de la configuration Firebase au chargement
        window.addEventListener('load', () => {
            console.log('=== DIAGNOSTIC FIREBASE ===');
            console.log('Configuration Firebase:', firebaseConfig);
            console.log('Firebase apps:', firebase.apps.length);
            console.log('Auth instance:', auth);
            console.log('Firestore instance:', db);
            console.log('URL actuelle:', window.location.href);
            console.log('Domaine:', window.location.hostname);
            console.log('=== FIN DIAGNOSTIC ===');
            
            // Test de connexion Firestore
            db.collection('test').doc('connection').set({
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                test: true
            }).then(() => {
                console.log('‚úÖ Test Firestore r√©ussi');
            }).catch((error) => {
                console.error('‚ùå Test Firestore √©chou√©:', error);
            });
        });
    </script>
</body>
</html>
